// Datei: ./werkzeuge/paketoperationen/liste-der-nicht-installierten-pakete-anzeigen.adoc

// Baustelle: Rohtext

[[liste-der-nicht-installierten-pakete-anzeigen]]

=== Liste der nicht installierten Pakete anzeigen ===

// Stichworte für den Index
(((Paket, nicht installiertes anzeigen)))

Hier besprechen wir, wie Sie herausfinden, ob eines oder mehrere Pakete 
nicht installiert sind. Das ist das Gegenstück zu "Liste der installierten 
Pakete anzeigen und deuten" (siehe 
<<liste-der-installierten-pakete-anzeigen-und-deuten>>).

Nach unserer Kenntnis existieren für die Kommandozeile vier grundlegende 
Möglichkeiten. Ins Spiel kommen `dpkg`, `dpkg-query`, `aptitude` und 
`apt`. Die Darstellung in den graphischen Programme beleuchten wir weiter 
unten genauer.

==== dpkg mit minimaler Ausgabe ====

// Stichworte für den Index
(((dpkg-query, -f)))
(((dpkg-query, --show)))
(((dpkg-query, --showformat)))
(((dpkg-query, -W)))
(((Paketliste, nur die Paketnamen ausgeben)))
Hier konzentrieren wir uns lediglich auf die Namen der derzeit nicht 
installierten Pakete ohne deren Versionsnummer und Beschreibung. Zwei 
Varianten liefern erste Lösungen:

* a) `dpkg-query` mit einem speziellen Formatstring für die Ausgabe 
  in Kombination mit `egrep`, `awk` und `sort` 
* b) die Kombination aus `dpkg`, `egrep`, `awk` und `sort`.

Für den *Fall a)* nutzen Sie den Schalter `-W` (Langform `--show`) und den 
Formatstring `-f='${db:Status-Abbrev} ${binary:Package}\n'`. Dabei kürzt 
`-f` die Langform `--showformat` ab. Die Angabe `'${db:Status-Abbrev}'` 
liefert Ihnen den Installationsstatus des Pakets und `$'{binary:Package}\n'` 
den Paketnamen aus der Paketbeschreibung samt Zeilenumbruch am Ende der 
Zeile. Der vollständige Aufruf ist dann wie folgt:

.Nur die Paketnamen ausgeben (`dpkg-query`)
----
$ dpkg-query -W -f='${db:Status-Abbrev} ${binary:Package}\n' '*' | egrep "^un" | awk '{ print $2 }' | sort
aalib1
accountsservice
adequate
adwaita-icon-theme-full
aide
alacritty
...
$
----

Ergebnis ist eine alphabetisch sortierte Liste der Paketnamen aller nicht 
installierten Debianpakete ohne weitere Angaben. *Fall b)* nutzt einen 
kompakteren Aufruf und kombiniert hierbei die Werkzeuge `dpkg`, `egrep`, 
`awk` und `sort` miteinander (das Ergebnis ist identisch zum Aufruf von
`dpkg-query`):
 
.Nur die Paketnamen ausgeben (`dpkg`, `egrep`, `awk` und `sort` kombiniert)
----
$ dpkg -l '*' | egrep "^un" | awk ' {print $2} ' | sort
aalib1
accountsservice
adequate
adwaita-icon-theme-full
aide
alacritty
...
$
----

Möchten Sie die Auflistung auf Pakete mit einem bestimmten Namensmuster
beschränken, ersetzen Sie im Aufruf den ersten `'*'` durch das gewünschte
Textfragment. Nachfolgendes Beispiel zeigt das für das Muster `'*ash*'`,
welches u.a. Erweiterungen für die Bash zutagefördert:

.Nicht installierte Pakete mit Muster finden
----
$ dpkg -l '*ash*' | egrep "^un" | awk ' {print $2} ' | sort
bash-doc
bash-static
dh-sequence-bash-completion
usplash
$
----

==== Suche mit `aptitude` ====

// Stichworte für den Index
(((aptitude, search '!~i')))
(((aptitude, search '!?installed')))

Zur Recherche im Paketbestand kennt das Werkzeug `aptitude` das 
Unterkommando `search`. Nach diesem erwartet es das Flag `'!~i'` für 
``nicht installierte Pakete'' (Langform `'!?installed'`). Ergebnis ist 
eine Liste aller nicht installierten Pakete. Daraus filtern wir im 
nachfolgenden Beispiel mittels `grep` nur die Zeilen heraus, in denen 
die Wortkombination `texlive-games` enthalten ist.

.`aptitude` listet die nicht installierten LaTeX-Games-Pakete auf
----
$ aptitude search '!~i' | grep texlive-games
p  texlive-games - TeX Live: Games typesetting
v  texlive-games:i386 -
$
----

Obiges Ergebnis umfaßt eine Zeile pro Paket mit Paketstatus, Paketname und
Beschreibung. Geht es Ihnen jedoch nur um die Namen der Pakete, ist etwas 
mehr Arbeit notwendig. Hier hilft die folgende Kombination aus `aptitude`, 
`grep`, `sed` und `awk` weiter und minimiert die Ausgabe erheblich:

.Paketliste mittels `aptitude` ausgeben
----
$ aptitude search '!~i' | grep texlive-games | sed -E 's/[pv] //'| awk ' { print $1 } '
texlive-games
texlive-games:i386
$
----

Die Angabe `-E 's/[pv] //'` bei `sed` aktiviert zunächst erweiterte 
Reguläre Ausdrücke (Schalter `-E`) und ersetzt danach alle Vorkommen der 
Zeichenkette aus einem kleinen `p` oder `v` gefolgt von einem Leerzeichen 
durch nichts (es löscht die Zeichen aus der Zeile). Die Angabe von 
`' { print $1 } '` bei `awk` gibt danach lediglich die erste Spalte jeder 
Zeile aus, die den Paketnamen enthält. Alle weiteren Informationen, die 
`aptitude` in seiner Ausgabe noch bereitgestellt hatte, entfallen.

==== `apt list` ====

// Stichworte für den Index
(((apt, list)))
Seit der Version 1.0 verfügt `apt` ebenfalls über einen Schalter `list`. 
Darüber erhalten Sie eine Auflistung aller Pakete. Jede Zeile der Ausgabe 
beinhaltet den Paketnamen, den Status der Veröffentlichung, die 
Versionsnummer, die Architektur und den Status der Installation. 

===== Alle Pakete auflisten =====

// Stichworte für den Index
(((apt, list)))
In Kombination mit `fgrep` und dem Parameter `-v` filtern Sie alle Zeilen 
aus der Ausgabe heraus, die die gesuchten Pakete beinhalten. Der Parameter
`-v '[installiert]'` sorgt dafür, dass `fgrep` die Ausgabe von `apt` auf 
die Zeilen reduziert, die das Suchmuster nicht enthalten.

.Recherche nach nicht installierten Paketen mittels `apt`
----
$ apt list | fgrep -v '[installiert]'

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Auflistung…
0ad-data-common/oldstable,oldstable 0.0.26-1 all
0ad-data/oldstable,oldstable 0.0.26-1 all
0ad/oldstable 0.0.26-3 amd64
0ad/oldstable 0.0.26-3 i386
0install-core/oldstable 2.18-2 amd64
0install-core/oldstable 2.18-2 i386
0install/oldstable 2.18-2 amd64
0install/oldstable 2.18-2 i386
0xffff/oldstable 0.9-1 amd64
...
$
----

===== Liste anhand von Filtern einschränken =====

// Stichworte für den Index
(((apt, Umgang mit Filtern)))
Analog zu `dpkg` kann auch `apt` mit Filtern umgehen, um darüber die Ausgabe
einzuschränken. `apt` akzeptiert dazu als Filter sowohl eine Liste von 
Paketnamen, als auch Muster. Das nachfolgende Beispiel schränkt die Ausgabe
von `apt` auf das Paket 'bash' ein. Ergebnis ist ein einziges Paket.

.Liste auf bestimmte Pakete eingrenzen
----
$ apt list bash | fgrep -v '[installiert]'

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Auflistung…
bash/oldstable 5.2.15-2+b9 i386
$
----

Muster interpretiert `apt` nach dem gleichen Prinzip wie `dpkg`. Das 
nachfolgende Beispiel zeigt die Recherche nach allen Paketen, die die 
Zeichenkette `ash` im Namen beinhalten, auf die keine weiteren Zeichen 
folgen, die aber ein beliebiges Präfix besitzen dürfen. Die Angabe eines 
Sterns (`*`) vor bzw. nach der Zeichenkette interpretiert `apt` als alle 
Zeichen in beliebiger Menge. Daher umfaßt die Ausgabe von `apt` bspw. 
sowohl die Pakete 'ash' und 'bash', als auch 'crash' und 'csmash'.

.Liste mit der Angabe eines Musters eingrenzen
----
$ apt list '*ash' | fgrep -v '[installiert]'

WARNING: apt does not have a stable CLI interface. Use with caution in scripts.

Auflistung…
ap51-flash/oldstable 2022.1-1 amd64
ap51-flash/oldstable 2022.1-1 i386
ash/oldstable,oldstable 0.5.12-2 all
bash/oldstable 5.2.15-2+b9 i386
caja-gtkhash/oldstable 1.4+git20220617-3 amd64
caja-gtkhash/oldstable 1.4+git20220617-3 i386
crash/oldstable 8.0.2-1 amd64
crash/oldstable 8.0.2-1 i386
csmash/oldstable 0.6.6-6.9 amd64
...
$
----

===== Ausgabe minimieren =====

Um die Ausgabe auf die Paketnamen einzugrenzen, helfen Ihnen wiederum die 
Werkzeuge `tail`, `fgrep`, `awk` und `uniq` weiter. Zunächst leiten Sie die
Ausgabe des Fehlerkanals nach `/dev/null` um -- somit entfällt die bislang
sichtbare Warnung. Mittels `tail` reduzieren Sie nun die Ausgabe auf alle 
Zeilen ab Zeile 2. Anschließend filtert `fgrep` alle Zeilen aus der Ausgabe, 
in denen die Zeichenkette `installiert` vorkommt. Mittels `awk` und dem `/` 
als Trennzeichen verkürzen Sie alle Zeilen auf die erste Spalte mit dem
Paketnamen. Zum Schluß benutzen Sie noch `uniq`, um mehrfach vorkommende 
Einträge aufzuräumen.

.`apt` listet nur die nicht installierten Pakete auf (Paketliste)
----
$ apt list '*ash' 2>/dev/null | tail -n+2 | fgrep -v 'installiert' | awk -F "/" ' { print $1 } ' | uniq
ap51-flash
ash
bash
caja-gtkhash
crash
csmash
dash
datamash
dracut-squash
...
$
----

==== Weitere Möglichkeiten ====

Graphische Programme wie beispielsweise Synaptic (siehe <<gui-synaptic>>) 
und SmartPM (siehe <<gui-smartpm>>) verwenden keine Buchstaben zur 
Kennzeichnung des Paketstatus, sondern nutzen stattdessen 
verschiedenfarbige Kästchen (``Icons''). In 
<<fig.synaptic-nicht-installierte-pakete>> sehen Sie passend gefilterte 
Paketliste.

.Auflistung der nichtinstallierten Pakete in Synaptic
image::werkzeuge/paketoperationen/synaptic-nicht-installierte-pakete.png[id="fig.synaptic-nicht-installierte-pakete", width="50%"]

// Datei (Ende): ./werkzeuge/paketoperationen/liste-der-nicht-installierten-pakete-anzeigen.adoc
